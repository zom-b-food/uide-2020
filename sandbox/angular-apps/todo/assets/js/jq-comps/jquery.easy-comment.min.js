function EasyComment(){this.commentUL=null}EasyComment.prototype.init=function(e,t,n,o,i,a,m,r,s){this.moderate=n?1:0,this.maxReply=r,this.currentPage=0,this.countPerPage=s,this.path=t,e?this.container=e:$("body").append(this.container=$("<div id='ec-page'></div>")[0]),null!==o&&(""===o||isNaN(o)?$(this.container).css("height","auto"):$(this.container).css("height",o+"px")),this.hasSubject=!0===i,this.hasEmail=!0===a,this.hasSite=!0===m,$(this.container).addClass("ec-comment-pane").append(this.totalComment=$("<div class='ec-total'></div>").html("Be the first person to leave a comment")[0]),0<this.countPerPage&&$(this.container).append(this.paging=$("<div class='ec-paging'></div>")[0]),$(this.container).append(this.commentUL=$("<ul></ul>").addClass("ec-comment-list")[0]);var l=this;$(this.container).find("button[name=reply]").live("click",function(){var e=$(this).attr("id").split("_")[1];$(l.replyFormContainer).find("button[name=submit_reply]").data("reply_id",e);var t=$(this).offset(),n=$(this).outerHeight(),o=t.left,i=t.top+n;l.showReplyForm(o,i)}),this.addCmtForm(),this.addReplyForm(),500<$(this.commentForm).width()&&($(this.commentForm).width(500),$(this.replyForm).width(500)),this.loadComment(0)},EasyComment.prototype._getFormFields=function(){return'<fieldset><legend>Your name:<span title="Required field" style="color:red;">*</span></legend><input type="text" style="width:100%" value="" name="name"></fieldset>'+(this.hasSubject?'<fieldset><legend><span style="color:red;margin-right:5px;"></span>Subject:</legend><input type="text" style="width:100%" value="" name="subject"></fieldset>':"")+(this.hasEmail?'<fieldset><legend><span style="color:red;margin-right:5px;"></span>Email:</legend><input type="email" style="width:100%" value="" name="email"></fieldset>':"")+(this.hasSite?'<fieldset><legend><span style="color:red;margin-right:5px;"></span>Web Site:</legend><input type="url" style="width:100%" value="" name="site"></fieldset>':"")+'<fieldset><legend>Comment:<span title="Required field" style="color:red;margin-right:5px;">*</span></legend><div style="vertical-align:top;"><textarea style="width:100%;height:180px;" name="message" type="text"></textarea></div></fieldset>'},EasyComment.prototype.addCmtForm=function(){var e=this,t=['<div class="ec-comment-form">','<form method="post" name="ec-comment-form">',"<fieldset>",'<legend class="title">Leave your comment here</legend>',this._getFormFields(),'<div style="text-align:right;position:relative;">','<div style="position:absolute;left:0px;bottom:0px;color:#444488;font:11px arial;">Powered by <a href="http://www.jswidget.com/lab/easy-comment.html" target="_blank">EasyComment</a></div>','<button name="submit">Submit</button>&nbsp;&nbsp;&nbsp;',"</div>","</fieldset>","</form>","</div>"];return $(this.container).append(t.join("")),this.commentForm=$(this.container).find(".ec-comment-form form[name=ec-comment-form]")[0],$(this.commentForm).find("button[name=submit]").click(function(){return e.submitMessage(e.commentForm,!1,""),!1}),this},EasyComment.prototype.addReplyForm=function(){var e=['<div class="ec-comment-form ec-comment-reply-form" style="display:none;">','<div class="close_button"></div>','<form method="post" name="ec-comment-reply-form">',"<fieldset>",this._getFormFields(),'<div style="text-align:right;position:relative;">','<button name="submit_reply">Reply</button>&nbsp;&nbsp;&nbsp;','<button class="close_button">Close</button>&nbsp;&nbsp;&nbsp;',"</div>","</fieldset>","</form>","</div>"];$("body").append(this.replyFormContainer=$(e.join(""))[0]),this.replyForm=$(this.replyFormContainer).find("form[name=ec-comment-reply-form]")[0];var t=this;return $(this.replyFormContainer).find(".close_button").click(function(){return t.hideReplyForm(),!1}),$(this.replyFormContainer).find("button[name=submit_reply]").click(function(){var e=$(this).data("reply_id");return t.submitMessage(t.replyForm,!0,e),!1}),this},EasyComment.prototype._renderComment=function(e,t){var n;for(n=0;n<e.length;n++)if(""===t)$(this.commentUL).prepend(e[n]);else{var o=$(this.commentUL).find("#"+t+" ul")[0];o||$(this.commentUL).find("#"+t).append(o=$("<ul></ul>").addClass("ec-comment-list")[0]),$(o).prepend(e[n])}},EasyComment.prototype._registerReply=function(e){var a=this;$(e).live("click",function(){var e=$(this).attr("id").split("_")[1];$(a.replyFormContainer).find("button[name=submit_reply]").data("reply_id",e);var t=$(this).offset(),n=$(this).outerHeight(),o=t.left,i=t.top+n;a.showReplyForm(o,i)})},EasyComment.prototype.showReplyForm=function(e,t){$(this.replyFormContainer).css({left:e+"px",top:t+"px",opacity:0,display:""}).animate({opacity:1},300)},EasyComment.prototype.hideReplyForm=function(){$(this.replyFormContainer).animate({opacity:0},300,function(){$(this).css("display","none")})},EasyComment.prototype.submitMessage=function(e,t,n){var o={flag:"1",domid:$(this.container).attr("id"),title:document.title,id:t?n:"",moderate:this.moderate,max:this.maxReply,path:this.path,url:this.getPageURL(),name:$.trim($(e).find("input[name=name]").val()),subject:this.hasSubject?$.trim($(e).find("input[name=subject]").val()):"",email:this.hasEmail?$.trim($(e).find("input[name=email]").val()):"",site:this.hasSite?$.trim($(e).find("input[name=site]").val()):"",message:$.trim($(e).find("textarea[name=message]").val())};if(""!==o.name)if(""!==o.message){var i=this;$.ajax({url:this.path+"ec-comment.php",data:o,dataType:"json",type:"POST",cache:!1,success:function(e){if(e){i._renderComment([e.comment],n);var t=$(i.totalComment).data("total-comment");""===n?t++:i.hideReplyForm(),i.showTotalComment(t)}},error:function(e){}})}else $(e).find("textarea[name=message]").focus();else $(e).find("input[name=name]").focus()},EasyComment.prototype.getPageURL=function(){var e=location.href;return-1!=(e=e.replace(/www\./,"")).indexOf("#")&&(e=e.split("#")[0]),-1!=e.indexOf("?")&&(e=e.split("?")[0]),e},EasyComment.prototype.loadComment=function(e){var t={flag:"2",max:this.maxReply,domid:$(this.container).attr("id"),url:this.getPageURL(),pageno:e||0,pagecount:this.countPerPage};this.currentPage=e;var n=this;$.ajax({url:this.path+"ec-comment.php",data:t,dataType:"json",type:"POST",cache:!1,success:function(e){e&&(0<e.total_comment&&($(n.commentUL).empty(),n._renderComment(e.comments,"")),n.showTotalComment(e.total_comment),n.showPaging(e.total_comment))},error:function(e){}})},EasyComment.prototype.showTotalComment=function(e){var t=e+" Comments ";$(this.totalComment).html(t).data("total-comment",e)},EasyComment.prototype.showPaging=function(e){if(0<this.countPerPage&&e>this.countPerPage){$(this.paging).empty();var t,n=Math.ceil(e/this.countPerPage),o=this,i=e-(this.currentPage+1)*this.countPerPage;t=i>this.countPerPage?"Next "+this.countPerPage+" comments":(i<0&&(i=this.countPerPage),"Next "+i+" comments"),$(this.paging).append($("<button></button>").html("Previous "+this.countPerPage+" comments").data("page_no",this.currentPage).attr("disabled",0==this.currentPage).click(function(){return o.loadComment($(this).data("page_no")-1),!1})),$(this.paging).append($("<button></button>").html(t).data("page_no",this.currentPage).attr("disabled",this.currentPage==n-1).click(function(){return o.loadComment($(this).data("page_no")+1),!1}))}},function(o){o.fn.EasyComment=function(e){var t,n={path:"/easy-comment/",maxReply:5,moderate:!1,height:null,hasSubject:!1,hasEmail:!1,hasSite:!1,countPerPage:10};return e&&o.extend(n,e),t=n.path,o.fn.EasyComment.StyleReady||(o.fn.EasyComment.StyleReady=!0,o(["<style type='text/css'>",".ec-comment-pane{position:relative; padding-left:20px; margin:5px 0; overflow:auto}",".ec-comment-pane div.ec-total{font:1.3em Georgia; height:24px; line-height:24px}",".ec-comment-pane div.ec-paging{height:30px; line-height:30px;text-align:right;}",".ec-comment-pane div.ec-paging>button{font:13px arial;height:30px; line-height:30px;margin-right:10px;}",".ec-comment-pane ul.ec-comment-list{position:relative; font-family:'Lucida Grande',sans-serif; font-size:14px; line-height:16px; list-style-type:none; padding:0px; background-color:#FFF; border:0px solid #14a1cc; border-radius:12px; overflow:auto}",".ec-comment-pane ul.ec-comment-list li.ec-comment{position:relative; min-height:48px; min-width:48px; padding:4px 4px 12px 56px; margin-bottom:8px; border-radius:4px; font-size:9pt arial}",".ec-comment-pane ul.ec-comment-list li.ec-comment:last-child{border:none; padding-bottom:0px}",".ec-comment-pane ul.ec-comment-list li.ec-comment button{font:11px arial}",".ec-comment-pane ul.ec-comment-list li.ec-comment a, ",".ec-comment-pane ul.ec-comment-list li.ec-comment .author{font-weight:bold; color:#2276bb; text-decoration:none}",".ec-comment-pane ul.ec-comment-list li.ec-comment a:hover{text-decoration:underline}",".ec-comment-pane ul.ec-comment-list li.ec-comment div.avatar{position:absolute; top:0px; left:0px; width:48px; height:48px; border:none; margin-top:6px; margin-left:2px; border-radius:4px; text-overflow:ellipsis; background:url("+t+"ec-comment.png)}",".ec-comment-pane ul.ec-comment-list li.ec-comment span.user-name{font-weight:bold; margin-right:0.5em; text-overflow:ellipsis}",".ec-comment-pane ul.ec-comment-list li.ec-comment span.comment-time{font-size:11px; color:#999; line-height:16px; text-overflow:ellipsis}",".ec-comment-form{font:1em Georgia}",".ec-comment-form form{margin:0; padding:0}",".ec-comment-form form input, .ec-comment-form form textarea, .ec-comment-form form button{font:1em arial}",".ec-comment-form fieldset{ background:-webkit-gradient(linear,0 0,0 bottom,from(#ffffff),to(#dddddd));  background:-moz-linear-gradient(#ffffff,#dddddd);  background:linear-gradient(#ffffff,#dddddd);  filter :progid:DXImageTransform.Microsoft.Gradient(GradientType=0,startColorstr=#ffffff,endColorstr=#dddddd)}",".ec-comment-form fieldset legend{ background:-webkit-gradient(linear,0 0,0 bottom,from(#ffffff),to(#dddddd));  background:-moz-linear-gradient(#ffffff,#dddddd);  background:linear-gradient(#ffffff,#dddddd);  filter :progid:DXImageTransform.Microsoft.Gradient(GradientType=0,startColorstr=#ffffff,endColorstr=#dddddd);  padding:0px 5px;  border-radius:6px;  border:1px solid #ccc}",".ec-comment-form .title{ color:#444;  line-height:30px}",".ec-comment-form fieldset{ border-radius:6px}",".ec-comment-form fieldset fieldset{ border:none;  background:none;  filter:none}",".ec-comment-form fieldset fieldset legend{ background:none;  border:none;  filter:none}",".ec-comment-reply-form{position:absolute; left:0px; top:0px; height:400px}",".ec-comment-reply-form div.close_button{ position:absolute;  right:-18px; top:-18px;  width:36px; height:36px;  background:url("+t+"ec-close_box.png) no-repeat;  cursor:pointer}","</style>"].join("")).appendTo("head")),this.each(function(){(new EasyComment).init(this,n.path,n.moderate,n.height,n.hasSubject,n.hasEmail,n.hasSite,n.maxReply,n.countPerPage)})}}(jQuery);
!function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):this.Picker=e(jQuery)}(function(m){var o=m(window),g=m(document),h=m(document.documentElement);function v(o,e,t,n){if(!o)return v;function r(){return this.start()}var i=!1,d={id:o.id||"P"+Math.abs(~~(Math.random()*new Date))},c=t?m.extend(!0,{},t.defaults,n):n||{},a=m.extend({},v.klasses(),c.klass),s=m(o),u=r.prototype={constructor:r,$node:s,start:function(){return d&&d.start?u:(d.methods={},d.start=!0,d.open=!1,d.type=o.type,o.autofocus=o==b(),o.readOnly=!c.editable,o.id=o.id||d.id,"text"!=o.type&&(o.type="text"),u.component=new t(u,c),u.$root=m(v._.node("div",f(),a.picker,'id="'+o.id+'_root" tabindex="0"')),u.$root.on({keydown:l,focusin:function(e){u.$root.removeClass(a.focused),e.stopPropagation()},"mousedown click":function(e){var t=e.target;t!=u.$root.children()[0]&&(e.stopPropagation(),"mousedown"!=e.type||m(t).is("input, select, textarea, button, option")||(e.preventDefault(),u.$root.eq(0).focus()))}}).on({focus:function(){s.addClass(a.target)},blur:function(){s.removeClass(a.target)}}).on("focus.toOpen",p).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var e=m(this),t=e.data(),n=e.hasClass(a.navDisabled)||e.hasClass(a.disabled),o=b();o=o&&(o.type||o.href),(n||o&&!m.contains(u.$root[0],o))&&u.$root.eq(0).focus(),!n&&t.nav?u.set("highlight",u.component.item.highlight,{nav:t.nav}):!n&&"pick"in t?u.set("select",t.pick):t.clear?u.clear().close(!0):t.close&&u.close(!0)}),_(u.$root[0],"hidden",!0),c.formatSubmit&&function(){var e;!0===c.hiddenName?(e=o.name,o.name=""):e=(e=["string"==typeof c.hiddenPrefix?c.hiddenPrefix:"","string"==typeof c.hiddenSuffix?c.hiddenSuffix:"_submit"])[0]+o.name+e[1];u._hidden=m('<input type=hidden name="'+e+'"'+(s.data("value")||o.value?' value="'+u.get("select",c.formatSubmit)+'"':"")+">")[0],s.on("change."+d.id,function(){u._hidden.value=o.value?u.get("select",c.formatSubmit):""}),c.container?m(c.container).append(u._hidden):s.after(u._hidden)}(),function(){s.data(e,u).addClass(a.input).attr("tabindex",-1).val(s.data("value")?u.get("select",c.format):o.value),c.editable||s.on("focus."+d.id+" click."+d.id,function(e){e.preventDefault(),u.$root.eq(0).focus()}).on("keydown."+d.id,l);_(o,{haspopup:!0,expanded:!1,readonly:!1,owns:o.id+"_root"})}(),c.container?m(c.container).append(u.$root):s.after(u.$root),u.on({start:u.component.onStart,render:u.component.onRender,stop:u.component.onStop,open:u.component.onOpen,close:u.component.onClose,set:u.component.onSet}).on({start:c.onStart,render:c.onRender,stop:c.onStop,open:c.onOpen,close:c.onClose,set:c.onSet}),i=function(e){var t,n="position";e.currentStyle?t=e.currentStyle[n]:window.getComputedStyle&&(t=getComputedStyle(e)[n]);return"fixed"==t}(u.$root.children()[0]),o.autofocus&&u.open(),u.trigger("start").trigger("render"))},render:function(e){return e?u.$root.html(f()):u.$root.find("."+a.box).html(u.component.nodes(d.open)),u.trigger("render")},stop:function(){return d.start&&(u.close(),u._hidden&&u._hidden.parentNode.removeChild(u._hidden),u.$root.remove(),s.removeClass(a.input).removeData(e),setTimeout(function(){s.off("."+d.id)},0),o.type=d.type,o.readOnly=!1,u.trigger("stop"),d.methods={},d.start=!1),u},open:function(e){return d.open?u:(s.addClass(a.active),_(o,"expanded",!0),setTimeout(function(){u.$root.addClass(a.opened),_(u.$root[0],"hidden",!1)},0),!1!==e&&(d.open=!0,i&&h.css("overflow","hidden").css("padding-right","+="+y()),u.$root.eq(0).focus(),g.on("click."+d.id+" focusin."+d.id,function(e){var t=e.target;t!=o&&t!=document&&3!=e.which&&u.close(t===u.$root.children()[0])}).on("keydown."+d.id,function(e){var t=e.keyCode,n=u.component.key[t],o=e.target;27==t?u.close(!0):o!=u.$root[0]||!n&&13!=t?m.contains(u.$root[0],o)&&13==t&&(e.preventDefault(),o.click()):(e.preventDefault(),n?v._.trigger(u.component.key.go,u,[v._.trigger(n)]):u.$root.find("."+a.highlighted).hasClass(a.disabled)||u.set("select",u.component.item.highlight).close())})),u.trigger("open"))},close:function(e){return e&&(u.$root.off("focus.toOpen").eq(0).focus(),setTimeout(function(){u.$root.on("focus.toOpen",p)},0)),s.removeClass(a.active),_(o,"expanded",!1),setTimeout(function(){u.$root.removeClass(a.opened+" "+a.focused),_(u.$root[0],"hidden",!0)},0),d.open?(d.open=!1,i&&h.css("overflow","").css("padding-right","-="+y()),g.off("."+d.id),u.trigger("close")):u},clear:function(e){return u.set("clear",null,e)},set:function(e,t,n){var o,r,i=m.isPlainObject(e),a=i?e:{};if(n=i&&m.isPlainObject(t)?t:n||{},e){for(o in i||(a[e]=t),a)r=a[o],o in u.component.item&&(void 0===r&&(r=null),u.component.set(o,r,n)),"select"!=o&&"clear"!=o||s.val("clear"==o?"":u.get(o,c.format)).trigger("change");u.render()}return n.muted?u:u.trigger("set",a)},get:function(e,t){if(null!=d[e=e||"value"])return d[e];if("valueSubmit"==e){if(u._hidden)return u._hidden.value;e="value"}if("value"==e)return o.value;if(e in u.component.item){if("string"!=typeof t)return u.component.get(e);var n=u.component.get(e);return n?v._.trigger(u.component.formats.toString,u.component,[t,n]):""}},on:function(e,t,n){var o,r,i=m.isPlainObject(e),a=i?e:{};if(e)for(o in i||(a[e]=t),a)r=a[o],n&&(o="_"+o),d.methods[o]=d.methods[o]||[],d.methods[o].push(r);return u},off:function(){var e,t,n=arguments;for(e=0,namesCount=n.length;e<namesCount;e+=1)(t=n[e])in d.methods&&delete d.methods[t];return u},trigger:function(e,n){function t(e){var t=d.methods[e];t&&t.map(function(e){v._.trigger(e,u,[n])})}return t("_"+e),t(e),u}};function f(){return v._.node("div",v._.node("div",v._.node("div",v._.node("div",u.component.nodes(d.open),a.box),a.wrap),a.frame),a.holder)}function l(e){var t=e.keyCode,n=/^(8|46)$/.test(t);if(27==t)return u.close(),!1;(32==t||n||!d.open&&u.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?u.clear().close():u.open())}function p(e){e.stopPropagation(),"focus"==e.type&&u.$root.addClass(a.focused),u.open()}return new r}function y(){if(h.height()<=o.height())return 0;var e=m('<div style="visibility:hidden;width:100px" />').appendTo("body"),t=e[0].offsetWidth;e.css("overflow","scroll");var n=m('<div style="width:100%" />').appendTo(e)[0].offsetWidth;return e.remove(),t-n}function _(e,t,n){if(m.isPlainObject(t))for(var o in t)r(e,o,t[o]);else r(e,t,n)}function r(e,t,n){e.setAttribute(("role"==t?"":"aria-")+t,n)}function b(){try{return document.activeElement}catch(e){}}return v.klasses=function(e){return{picker:e=e||"picker",opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},v._={group:function(e){for(var t,n="",o=v._.trigger(e.min,e);o<=v._.trigger(e.max,e,[o]);o+=e.i)t=v._.trigger(e.item,e,[o]),n+=v._.node(e.node,t[0],t[1],t[2]);return n},node:function(e,t,n,o){return t?"<"+e+(n=n?' class="'+n+'"':"")+(o=o?" "+o:"")+">"+(t=m.isArray(t)?t.join(""):t)+"</"+e+">":""},lead:function(e){return(e<10?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return-1<{}.toString.call(e).indexOf("Date")&&this.isInteger(e.getDate())},isInteger:function(e){return-1<{}.toString.call(e).indexOf("Number")&&e%1==0},ariaAttr:function(e,t){m.isPlainObject(e)||(e={attribute:t});for(var n in t="",e){var o=("role"==n?"":"aria-")+n,r=e[n];t+=null==r?"":o+'="'+e[n]+'"'}return t}},v.extend=function(o,r){m.fn[o]=function(e,t){var n=this.data(o);return"picker"==e?n:n&&"string"==typeof e?v._.trigger(n[e],n,[t]):this.each(function(){m(this).data(o)||new v(this,o,r,e)})},m.fn[o].defaults=r.defaults},v});